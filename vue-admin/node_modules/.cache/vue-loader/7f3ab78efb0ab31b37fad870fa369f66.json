{"remainingRequest":"E:\\project\\jy-movie\\vue-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\project\\jy-movie\\vue-admin\\src\\views\\worker\\List.vue?vue&type=style&index=0&id=7f721105&scoped=true&lang=css","dependencies":[{"path":"E:\\project\\jy-movie\\vue-admin\\src\\views\\worker\\List.vue","mtime":1711419811826},{"path":"E:\\project\\jy-movie\\vue-admin\\node_modules\\css-loader\\dist\\cjs.js","mtime":1711422140478},{"path":"E:\\project\\jy-movie\\vue-admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1711422145028},{"path":"E:\\project\\jy-movie\\vue-admin\\node_modules\\postcss-loader\\src\\index.js","mtime":1711422142576},{"path":"E:\\project\\jy-movie\\vue-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1711422139374},{"path":"E:\\project\\jy-movie\\vue-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1711422143977}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouZGVtby10YWJsZS1leHBhbmQgew0KICBmb250LXNpemU6IDA7DQp9DQoNCi5kZW1vLXRhYmxlLWV4cGFuZCBsYWJlbCB7DQogIHdpZHRoOiA5MHB4Ow0KICBjb2xvcjogIzk5YTliZjsNCn0NCg0KLmRlbW8tdGFibGUtZXhwYW5kIC5lbC1mb3JtLWl0ZW0gew0KICBtYXJnaW4tcmlnaHQ6IDA7DQogIG1hcmdpbi1ib3R0b206IDA7DQogIHdpZHRoOiA1MCU7DQp9DQo="},{"version":3,"sources":["List.vue"],"names":[],"mappings":";AA0RA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"List.vue","sourceRoot":"src/views/worker","sourcesContent":["<template>\r\n  <div class=\"main\">\r\n\r\n    <el-table\r\n        :data=\"workerList\"\r\n        style=\"width: 100%\">\r\n      <el-table-column type=\"expand\">\r\n        <template slot-scope=\"props\">\r\n          <el-form label-position=\"left\" inline class=\"demo-table-expand\">\r\n            <el-form-item label=\"用户名\">\r\n              <span>{{ props.row.username }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"昵称\">\r\n              <span>{{ props.row.nickname }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"密码\">\r\n              <el-button type=\"text\" @click=\"openUpdatePassword(props.row)\">\r\n                <i class=\"el-icon-edit\"></i>编辑密码\r\n              </el-button>\r\n            </el-form-item>\r\n            <el-form-item label=\"联系电话\">\r\n              <span>{{ props.row.phone }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"性别\">\r\n              <span>{{ props.row.gender }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"入职部门\">\r\n              <span>{{ props.row.department }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"状态\">\r\n              <span v-if=\"props.row.entry\">在职\r\n              <el-button @click=\"changeEntry(props.$index, props.row)\" type=\"text\">员工已离职？</el-button></span>\r\n              <span style=\"color: #f56c6c\" v-else>离职</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"更新时间\">\r\n              <span>{{ props.row.updateAt }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"员工头像\">\r\n              <a v-if=\"props.row.avatar\" target=\"_blank\" :href=\"props.row.avatar\">\r\n                <i class=\"el-icon-view\"></i>查看\r\n              </a>\r\n              <span v-else>他还没有上传头像</span>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button :disabled=\"!props.row.entry\"\r\n                         @click=\"handleListRole(props.row)\"\r\n                         type=\"info\"\r\n                         size=\"small\"\r\n                         plain>查看权限\r\n              </el-button>\r\n              <el-button :disabled=\"!props.row.entry\"\r\n                         type=\"primary\"\r\n                         @click=\"handleAddRole(props.row)\"\r\n                         size=\"small\"\r\n                         plain>添加权限\r\n              </el-button>\r\n              <el-button :disabled=\"props.row.entry\"\r\n                         @click=\"handleDeleteWork(props.$index, props.row.id)\"\r\n                         size=\"small\"\r\n                         type=\"danger\"\r\n                         plain>删除员工\r\n              </el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </template>\r\n      </el-table-column>\r\n\r\n      <el-table-column\r\n          label=\"员工 ID\"\r\n          width=\"430\"\r\n          prop=\"id\">\r\n      </el-table-column>\r\n      <el-table-column\r\n          label=\"用户名\"\r\n          width=\"200\"\r\n          prop=\"username\">\r\n      </el-table-column>\r\n      <el-table-column\r\n          label=\"所在部门\"\r\n          width=\"150\">\r\n        <template slot-scope=\"scope\">\r\n          <el-tag>{{ scope.row.department }}</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column\r\n          label=\"联系电话\"\r\n          width=\"240\"\r\n          prop=\"phone\">\r\n      </el-table-column>\r\n      <el-table-column\r\n          label=\"入职时间\"\r\n          prop=\"createAt\">\r\n      </el-table-column>\r\n\r\n    </el-table>\r\n\r\n    <el-dialog title=\"员工权限\" :visible.sync=\"roleDialogVisible\">\r\n      <el-table v-loading=\"loading\" :data=\"roleList\">\r\n        <el-table-column property=\"value\" label=\"权限\" width=\"300\"></el-table-column>\r\n        <el-table-column property=\"createAt\" label=\"创建时间\" width=\"300\"></el-table-column>\r\n        <el-table-column label=\"操作\">\r\n          <template slot-scope=\"scope\">\r\n            <el-popconfirm\r\n                @confirm=\"handleDeleteRole(scope.$index, scope.row.id)\"\r\n                :title=\"'确定删除权限 < ' + scope.row.value +' > 吗？'\"\r\n            >\r\n              <el-button slot=\"reference\" size=\"small\" type=\"danger\" icon=\"el-icon-delete\" plain>删除</el-button>\r\n            </el-popconfirm>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </el-dialog>\r\n\r\n    <el-dialog width=\"450px\" title=\"新增权限\" :visible.sync=\"dialogFormVisible\">\r\n      <el-form :model=\"addRoleForm\">\r\n        <el-form-item label=\"权限列表\" label-width=\"120px\">\r\n          <el-select v-model=\"addRoleForm.value\" placeholder=\"请选择新增的权限\">\r\n            <el-option v-for=\"(item, index) in systemRoles\"\r\n                       :key=\"index\"\r\n                       :label=\"item\"\r\n                       :value=\"item\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitAddRole\">确 定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  CreateWorkerRole,\r\n  DeleteRoleByWorkerId,\r\n  DeleteWorker,\r\n  FindAllWorker,\r\n  FindWorkerRoles,\r\n  ListSystemRoles,\r\n  UpdateWorker\r\n} from \"@/api/worker\";\r\n\r\nexport default {\r\n\r\n\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      addRoleForm: {\r\n        wid: '',\r\n        value: '',\r\n      },\r\n      workerList: [],\r\n      systemRoles: [],\r\n      roleDialogVisible: false,\r\n      roleList: [],\r\n      dialogFormVisible: false,\r\n    }\r\n  },\r\n\r\n  mounted() {\r\n    FindAllWorker().then(res => {\r\n      this.workerList = res.data\r\n    })\r\n    ListSystemRoles().then(res => {\r\n      this.systemRoles = res.data\r\n    })\r\n  },\r\n\r\n  methods: {\r\n\r\n    openUpdatePassword(worker) {\r\n      this.$prompt('请输入新的密码', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n      }).then(({value}) => {\r\n        if (!value) {\r\n          this.$message({\r\n            message: '密码不能为空',\r\n            type: 'danger',\r\n          });\r\n          return\r\n        }\r\n        if (value.length < 6) {\r\n          this.$message({\r\n            message: '请输入不少于6位的密码',\r\n            type: 'danger',\r\n          });\r\n          return\r\n        }\r\n        worker.password = value\r\n        UpdateWorker(worker).then(res => {\r\n          this.$message({\r\n            message: '账号密码修改成功',\r\n            type: 'success',\r\n          });\r\n        })\r\n      }).catch(() => {\r\n        this.$message({\r\n          type: 'info',\r\n          message: '取消修改'\r\n        });\r\n      });\r\n    },\r\n\r\n    changeEntry(index, worker) {\r\n      this.$confirm('此操作将该员工状态永久修改为离职, 是否继续?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        worker.entry = false\r\n        UpdateWorker(worker).then(res => {\r\n          this.$message({\r\n            type: 'success',\r\n            message: '员工离职成功!'\r\n          });\r\n        })\r\n      })\r\n    },\r\n\r\n    handleDeleteWork(index, id) {\r\n      DeleteWorker(id).then(res => {\r\n        this.workerList.splice(index, 1)\r\n        this.$message({\r\n          type: 'success',\r\n          message: '员工信息删除成功!'\r\n        });\r\n      })\r\n    },\r\n\r\n    handleListRole(worker) {\r\n      this.roleDialogVisible = true;\r\n      this.loading = true;\r\n      FindWorkerRoles(worker.id).then(res => {\r\n        setTimeout(() => {\r\n          this.roleList = res.data\r\n          this.loading = false;\r\n        }, 700)\r\n      })\r\n    },\r\n\r\n    handleDeleteRole(index, id) {\r\n      DeleteRoleByWorkerId(id).then(res => {\r\n        if (res.success === true) {\r\n          this.roleList.splice(index, 1)\r\n          this.$message({\r\n            type: 'success',\r\n            message: '员工权限删除成功!'\r\n          });\r\n        }\r\n      })\r\n    },\r\n\r\n    handleAddRole(worker) {\r\n      this.dialogFormVisible = true;\r\n      this.addRoleForm.wid = worker.id;\r\n    },\r\n\r\n    submitAddRole() {\r\n      CreateWorkerRole(this.addRoleForm).then(res => {\r\n        if (res.success) {\r\n          this.dialogFormVisible = false;\r\n          this.addRoleForm.wid = '';\r\n          this.addRoleForm.value = '';\r\n          this.$message({\r\n            type: 'success',\r\n            message: '员工权限添加成功!'\r\n          });\r\n        }\r\n      })\r\n    },\r\n\r\n  },\r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.demo-table-expand {\r\n  font-size: 0;\r\n}\r\n\r\n.demo-table-expand label {\r\n  width: 90px;\r\n  color: #99a9bf;\r\n}\r\n\r\n.demo-table-expand .el-form-item {\r\n  margin-right: 0;\r\n  margin-bottom: 0;\r\n  width: 50%;\r\n}\r\n</style>"]}]}