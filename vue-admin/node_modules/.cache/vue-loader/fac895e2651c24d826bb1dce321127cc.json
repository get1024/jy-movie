{"remainingRequest":"E:\\project\\jy-movie\\vue-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\project\\jy-movie\\vue-admin\\src\\views\\worker\\List.vue?vue&type=script&lang=js","dependencies":[{"path":"E:\\project\\jy-movie\\vue-admin\\src\\views\\worker\\List.vue","mtime":1711419811826},{"path":"E:\\project\\jy-movie\\vue-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1711422139374},{"path":"E:\\project\\jy-movie\\vue-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1711422143977}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgew0KICBDcmVhdGVXb3JrZXJSb2xlLA0KICBEZWxldGVSb2xlQnlXb3JrZXJJZCwNCiAgRGVsZXRlV29ya2VyLA0KICBGaW5kQWxsV29ya2VyLA0KICBGaW5kV29ya2VyUm9sZXMsDQogIExpc3RTeXN0ZW1Sb2xlcywNCiAgVXBkYXRlV29ya2VyDQp9IGZyb20gIkAvYXBpL3dvcmtlciI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCg0KDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGxvYWRpbmc6IGZhbHNlLA0KICAgICAgYWRkUm9sZUZvcm06IHsNCiAgICAgICAgd2lkOiAnJywNCiAgICAgICAgdmFsdWU6ICcnLA0KICAgICAgfSwNCiAgICAgIHdvcmtlckxpc3Q6IFtdLA0KICAgICAgc3lzdGVtUm9sZXM6IFtdLA0KICAgICAgcm9sZURpYWxvZ1Zpc2libGU6IGZhbHNlLA0KICAgICAgcm9sZUxpc3Q6IFtdLA0KICAgICAgZGlhbG9nRm9ybVZpc2libGU6IGZhbHNlLA0KICAgIH0NCiAgfSwNCg0KICBtb3VudGVkKCkgew0KICAgIEZpbmRBbGxXb3JrZXIoKS50aGVuKHJlcyA9PiB7DQogICAgICB0aGlzLndvcmtlckxpc3QgPSByZXMuZGF0YQ0KICAgIH0pDQogICAgTGlzdFN5c3RlbVJvbGVzKCkudGhlbihyZXMgPT4gew0KICAgICAgdGhpcy5zeXN0ZW1Sb2xlcyA9IHJlcy5kYXRhDQogICAgfSkNCiAgfSwNCg0KICBtZXRob2RzOiB7DQoNCiAgICBvcGVuVXBkYXRlUGFzc3dvcmQod29ya2VyKSB7DQogICAgICB0aGlzLiRwcm9tcHQoJ+ivt+i+k+WFpeaWsOeahOWvhueggScsICfmj5DnpLonLCB7DQogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywNCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsDQogICAgICB9KS50aGVuKCh7dmFsdWV9KSA9PiB7DQogICAgICAgIGlmICghdmFsdWUpIHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICAgIG1lc3NhZ2U6ICflr4bnoIHkuI3og73kuLrnqbonLA0KICAgICAgICAgICAgdHlwZTogJ2RhbmdlcicsDQogICAgICAgICAgfSk7DQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA8IDYpIHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICAgIG1lc3NhZ2U6ICfor7fovpPlhaXkuI3lsJHkuo425L2N55qE5a+G56CBJywNCiAgICAgICAgICAgIHR5cGU6ICdkYW5nZXInLA0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgIHdvcmtlci5wYXNzd29yZCA9IHZhbHVlDQogICAgICAgIFVwZGF0ZVdvcmtlcih3b3JrZXIpLnRoZW4ocmVzID0+IHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICAgIG1lc3NhZ2U6ICfotKblj7flr4bnoIHkv67mlLnmiJDlip8nLA0KICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLA0KICAgICAgICAgIH0pOw0KICAgICAgICB9KQ0KICAgICAgfSkuY2F0Y2goKCkgPT4gew0KICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICB0eXBlOiAnaW5mbycsDQogICAgICAgICAgbWVzc2FnZTogJ+WPlua2iOS/ruaUuScNCiAgICAgICAgfSk7DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgY2hhbmdlRW50cnkoaW5kZXgsIHdvcmtlcikgew0KICAgICAgdGhpcy4kY29uZmlybSgn5q2k5pON5L2c5bCG6K+l5ZGY5bel54q25oCB5rC45LmF5L+u5pS55Li656a76IGMLCDmmK/lkKbnu6fnu60/JywgJ+aPkOekuicsIHsNCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLA0KICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywNCiAgICAgICAgdHlwZTogJ3dhcm5pbmcnDQogICAgICB9KS50aGVuKCgpID0+IHsNCiAgICAgICAgd29ya2VyLmVudHJ5ID0gZmFsc2UNCiAgICAgICAgVXBkYXRlV29ya2VyKHdvcmtlcikudGhlbihyZXMgPT4gew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uoew0KICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLA0KICAgICAgICAgICAgbWVzc2FnZTogJ+WRmOW3peemu+iBjOaIkOWKnyEnDQogICAgICAgICAgfSk7DQogICAgICAgIH0pDQogICAgICB9KQ0KICAgIH0sDQoNCiAgICBoYW5kbGVEZWxldGVXb3JrKGluZGV4LCBpZCkgew0KICAgICAgRGVsZXRlV29ya2VyKGlkKS50aGVuKHJlcyA9PiB7DQogICAgICAgIHRoaXMud29ya2VyTGlzdC5zcGxpY2UoaW5kZXgsIDEpDQogICAgICAgIHRoaXMuJG1lc3NhZ2Uoew0KICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywNCiAgICAgICAgICBtZXNzYWdlOiAn5ZGY5bel5L+h5oGv5Yig6Zmk5oiQ5YqfIScNCiAgICAgICAgfSk7DQogICAgICB9KQ0KICAgIH0sDQoNCiAgICBoYW5kbGVMaXN0Um9sZSh3b3JrZXIpIHsNCiAgICAgIHRoaXMucm9sZURpYWxvZ1Zpc2libGUgPSB0cnVlOw0KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsNCiAgICAgIEZpbmRXb3JrZXJSb2xlcyh3b3JrZXIuaWQpLnRoZW4ocmVzID0+IHsNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgdGhpcy5yb2xlTGlzdCA9IHJlcy5kYXRhDQogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7DQogICAgICAgIH0sIDcwMCkNCiAgICAgIH0pDQogICAgfSwNCg0KICAgIGhhbmRsZURlbGV0ZVJvbGUoaW5kZXgsIGlkKSB7DQogICAgICBEZWxldGVSb2xlQnlXb3JrZXJJZChpZCkudGhlbihyZXMgPT4gew0KICAgICAgICBpZiAocmVzLnN1Y2Nlc3MgPT09IHRydWUpIHsNCiAgICAgICAgICB0aGlzLnJvbGVMaXN0LnNwbGljZShpbmRleCwgMSkNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywNCiAgICAgICAgICAgIG1lc3NhZ2U6ICflkZjlt6XmnYPpmZDliKDpmaTmiJDlip8hJw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9KQ0KICAgIH0sDQoNCiAgICBoYW5kbGVBZGRSb2xlKHdvcmtlcikgew0KICAgICAgdGhpcy5kaWFsb2dGb3JtVmlzaWJsZSA9IHRydWU7DQogICAgICB0aGlzLmFkZFJvbGVGb3JtLndpZCA9IHdvcmtlci5pZDsNCiAgICB9LA0KDQogICAgc3VibWl0QWRkUm9sZSgpIHsNCiAgICAgIENyZWF0ZVdvcmtlclJvbGUodGhpcy5hZGRSb2xlRm9ybSkudGhlbihyZXMgPT4gew0KICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsNCiAgICAgICAgICB0aGlzLmRpYWxvZ0Zvcm1WaXNpYmxlID0gZmFsc2U7DQogICAgICAgICAgdGhpcy5hZGRSb2xlRm9ybS53aWQgPSAnJzsNCiAgICAgICAgICB0aGlzLmFkZFJvbGVGb3JtLnZhbHVlID0gJyc7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7DQogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsDQogICAgICAgICAgICBtZXNzYWdlOiAn5ZGY5bel5p2D6ZmQ5re75Yqg5oiQ5YqfIScNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KDQogIH0sDQoNCn0NCg=="},{"version":3,"sources":["List.vue"],"names":[],"mappings":";AAuIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA","file":"List.vue","sourceRoot":"src/views/worker","sourcesContent":["<template>\r\n  <div class=\"main\">\r\n\r\n    <el-table\r\n        :data=\"workerList\"\r\n        style=\"width: 100%\">\r\n      <el-table-column type=\"expand\">\r\n        <template slot-scope=\"props\">\r\n          <el-form label-position=\"left\" inline class=\"demo-table-expand\">\r\n            <el-form-item label=\"用户名\">\r\n              <span>{{ props.row.username }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"昵称\">\r\n              <span>{{ props.row.nickname }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"密码\">\r\n              <el-button type=\"text\" @click=\"openUpdatePassword(props.row)\">\r\n                <i class=\"el-icon-edit\"></i>编辑密码\r\n              </el-button>\r\n            </el-form-item>\r\n            <el-form-item label=\"联系电话\">\r\n              <span>{{ props.row.phone }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"性别\">\r\n              <span>{{ props.row.gender }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"入职部门\">\r\n              <span>{{ props.row.department }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"状态\">\r\n              <span v-if=\"props.row.entry\">在职\r\n              <el-button @click=\"changeEntry(props.$index, props.row)\" type=\"text\">员工已离职？</el-button></span>\r\n              <span style=\"color: #f56c6c\" v-else>离职</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"更新时间\">\r\n              <span>{{ props.row.updateAt }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"员工头像\">\r\n              <a v-if=\"props.row.avatar\" target=\"_blank\" :href=\"props.row.avatar\">\r\n                <i class=\"el-icon-view\"></i>查看\r\n              </a>\r\n              <span v-else>他还没有上传头像</span>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button :disabled=\"!props.row.entry\"\r\n                         @click=\"handleListRole(props.row)\"\r\n                         type=\"info\"\r\n                         size=\"small\"\r\n                         plain>查看权限\r\n              </el-button>\r\n              <el-button :disabled=\"!props.row.entry\"\r\n                         type=\"primary\"\r\n                         @click=\"handleAddRole(props.row)\"\r\n                         size=\"small\"\r\n                         plain>添加权限\r\n              </el-button>\r\n              <el-button :disabled=\"props.row.entry\"\r\n                         @click=\"handleDeleteWork(props.$index, props.row.id)\"\r\n                         size=\"small\"\r\n                         type=\"danger\"\r\n                         plain>删除员工\r\n              </el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </template>\r\n      </el-table-column>\r\n\r\n      <el-table-column\r\n          label=\"员工 ID\"\r\n          width=\"430\"\r\n          prop=\"id\">\r\n      </el-table-column>\r\n      <el-table-column\r\n          label=\"用户名\"\r\n          width=\"200\"\r\n          prop=\"username\">\r\n      </el-table-column>\r\n      <el-table-column\r\n          label=\"所在部门\"\r\n          width=\"150\">\r\n        <template slot-scope=\"scope\">\r\n          <el-tag>{{ scope.row.department }}</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column\r\n          label=\"联系电话\"\r\n          width=\"240\"\r\n          prop=\"phone\">\r\n      </el-table-column>\r\n      <el-table-column\r\n          label=\"入职时间\"\r\n          prop=\"createAt\">\r\n      </el-table-column>\r\n\r\n    </el-table>\r\n\r\n    <el-dialog title=\"员工权限\" :visible.sync=\"roleDialogVisible\">\r\n      <el-table v-loading=\"loading\" :data=\"roleList\">\r\n        <el-table-column property=\"value\" label=\"权限\" width=\"300\"></el-table-column>\r\n        <el-table-column property=\"createAt\" label=\"创建时间\" width=\"300\"></el-table-column>\r\n        <el-table-column label=\"操作\">\r\n          <template slot-scope=\"scope\">\r\n            <el-popconfirm\r\n                @confirm=\"handleDeleteRole(scope.$index, scope.row.id)\"\r\n                :title=\"'确定删除权限 < ' + scope.row.value +' > 吗？'\"\r\n            >\r\n              <el-button slot=\"reference\" size=\"small\" type=\"danger\" icon=\"el-icon-delete\" plain>删除</el-button>\r\n            </el-popconfirm>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </el-dialog>\r\n\r\n    <el-dialog width=\"450px\" title=\"新增权限\" :visible.sync=\"dialogFormVisible\">\r\n      <el-form :model=\"addRoleForm\">\r\n        <el-form-item label=\"权限列表\" label-width=\"120px\">\r\n          <el-select v-model=\"addRoleForm.value\" placeholder=\"请选择新增的权限\">\r\n            <el-option v-for=\"(item, index) in systemRoles\"\r\n                       :key=\"index\"\r\n                       :label=\"item\"\r\n                       :value=\"item\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitAddRole\">确 定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  CreateWorkerRole,\r\n  DeleteRoleByWorkerId,\r\n  DeleteWorker,\r\n  FindAllWorker,\r\n  FindWorkerRoles,\r\n  ListSystemRoles,\r\n  UpdateWorker\r\n} from \"@/api/worker\";\r\n\r\nexport default {\r\n\r\n\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      addRoleForm: {\r\n        wid: '',\r\n        value: '',\r\n      },\r\n      workerList: [],\r\n      systemRoles: [],\r\n      roleDialogVisible: false,\r\n      roleList: [],\r\n      dialogFormVisible: false,\r\n    }\r\n  },\r\n\r\n  mounted() {\r\n    FindAllWorker().then(res => {\r\n      this.workerList = res.data\r\n    })\r\n    ListSystemRoles().then(res => {\r\n      this.systemRoles = res.data\r\n    })\r\n  },\r\n\r\n  methods: {\r\n\r\n    openUpdatePassword(worker) {\r\n      this.$prompt('请输入新的密码', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n      }).then(({value}) => {\r\n        if (!value) {\r\n          this.$message({\r\n            message: '密码不能为空',\r\n            type: 'danger',\r\n          });\r\n          return\r\n        }\r\n        if (value.length < 6) {\r\n          this.$message({\r\n            message: '请输入不少于6位的密码',\r\n            type: 'danger',\r\n          });\r\n          return\r\n        }\r\n        worker.password = value\r\n        UpdateWorker(worker).then(res => {\r\n          this.$message({\r\n            message: '账号密码修改成功',\r\n            type: 'success',\r\n          });\r\n        })\r\n      }).catch(() => {\r\n        this.$message({\r\n          type: 'info',\r\n          message: '取消修改'\r\n        });\r\n      });\r\n    },\r\n\r\n    changeEntry(index, worker) {\r\n      this.$confirm('此操作将该员工状态永久修改为离职, 是否继续?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        worker.entry = false\r\n        UpdateWorker(worker).then(res => {\r\n          this.$message({\r\n            type: 'success',\r\n            message: '员工离职成功!'\r\n          });\r\n        })\r\n      })\r\n    },\r\n\r\n    handleDeleteWork(index, id) {\r\n      DeleteWorker(id).then(res => {\r\n        this.workerList.splice(index, 1)\r\n        this.$message({\r\n          type: 'success',\r\n          message: '员工信息删除成功!'\r\n        });\r\n      })\r\n    },\r\n\r\n    handleListRole(worker) {\r\n      this.roleDialogVisible = true;\r\n      this.loading = true;\r\n      FindWorkerRoles(worker.id).then(res => {\r\n        setTimeout(() => {\r\n          this.roleList = res.data\r\n          this.loading = false;\r\n        }, 700)\r\n      })\r\n    },\r\n\r\n    handleDeleteRole(index, id) {\r\n      DeleteRoleByWorkerId(id).then(res => {\r\n        if (res.success === true) {\r\n          this.roleList.splice(index, 1)\r\n          this.$message({\r\n            type: 'success',\r\n            message: '员工权限删除成功!'\r\n          });\r\n        }\r\n      })\r\n    },\r\n\r\n    handleAddRole(worker) {\r\n      this.dialogFormVisible = true;\r\n      this.addRoleForm.wid = worker.id;\r\n    },\r\n\r\n    submitAddRole() {\r\n      CreateWorkerRole(this.addRoleForm).then(res => {\r\n        if (res.success) {\r\n          this.dialogFormVisible = false;\r\n          this.addRoleForm.wid = '';\r\n          this.addRoleForm.value = '';\r\n          this.$message({\r\n            type: 'success',\r\n            message: '员工权限添加成功!'\r\n          });\r\n        }\r\n      })\r\n    },\r\n\r\n  },\r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.demo-table-expand {\r\n  font-size: 0;\r\n}\r\n\r\n.demo-table-expand label {\r\n  width: 90px;\r\n  color: #99a9bf;\r\n}\r\n\r\n.demo-table-expand .el-form-item {\r\n  margin-right: 0;\r\n  margin-bottom: 0;\r\n  width: 50%;\r\n}\r\n</style>"]}]}